<!-- Contact Header -->
<section class="section">
    <div class="container">
        <h1 class="text-center">Contact Us</h1>
        <p class="text-center">We're here to help! Reach out to us with any questions or to book an appointment.</p>
        
        <% if (typeof success !== 'undefined' && success) { %>
            <div class="success-message" style="background-color: #d4edda; color: #155724; padding: 15px; margin: 20px 0; border-radius: 4px; text-align: center;">
                Thank you for your booking request! We'll contact you shortly to confirm your appointment.
            </div>
        <% } %>
    </div>
</section>

<!-- Contact Content -->
<section class="section" style="padding-top: 0;">
    <div class="container">
        <div class="grid contact-grid" style="grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
            <!-- Contact Information -->
            <div class="contact-info">
                <h2>Get in Touch</h2>
                <div style="margin-bottom: var(--spacing-md);">
                    <h3>Address</h3>
                    <p><%= siteInfo.address %></p>
                </div>
                
                <div style="margin-bottom: var(--spacing-md);">
                    <h3>Phone</h3>
                    <p><a href="tel:<%= siteInfo.phone %>"><%= siteInfo.phone %></a></p>
                </div>
                
                <div style="margin-bottom: var(--spacing-md);">
                    <h3>Email</h3>
                    <p><a href="mailto:<%= siteInfo.email %>"><%= siteInfo.email %></a></p>
                </div>
                
                <div style="margin-bottom: var(--spacing-md);">
                    <h3>Hours</h3>
                    <p>
                        Monday - Friday: <%= siteInfo.hours.monday %><br>
                        Saturday: <%= siteInfo.hours.saturday %><br>
                        Sunday: <%= siteInfo.hours.sunday %>
                    </p>
                </div>
            </div>
            
            <!-- Contact Form -->
            <div class="booking-form">
                <h2>Book an Appointment</h2>
                <form id="contact-form" method="POST" action="/booking">
                    <div style="margin-bottom: var(--spacing-sm);">
                        <label for="name" style="display: block; margin-bottom: 5px;">Name *</label>
                        <input type="text" id="name" name="name" required style="width: 100%; padding: 10px; border: 1px solid var(--color-gray); border-radius: var(--border-radius);">
                    </div>
                    
                    <div style="margin-bottom: var(--spacing-sm);">
                        <label for="email" style="display: block; margin-bottom: 5px;">Email *</label>
                        <input type="email" id="email" name="email" required style="width: 100%; padding: 10px; border: 1px solid var(--color-gray); border-radius: var(--border-radius);">
                    </div>
                    
                    <div style="margin-bottom: var(--spacing-sm);">
                        <label for="phone" style="display: block; margin-bottom: 5px;">Phone *</label>
                        <input type="tel" id="phone" name="phone" required style="width: 100%; padding: 10px; border: 1px solid var(--color-gray); border-radius: var(--border-radius);">
                    </div>
                    
                    <div style="margin-bottom: var(--spacing-sm);">
                        <label for="service" style="display: block; margin-bottom: 5px;">Service *</label>
                        <select id="service" name="service" required style="width: 100%; padding: 10px; border: 1px solid var(--color-gray); border-radius: var(--border-radius);">
                            <option value="">Select a Service</option>
                            <!-- Dynamically loaded services will appear here -->
                        </select>
                    </div>
                    
                    <!-- Load services from database -->
                    <script>
                        document.addEventListener('DOMContentLoaded', function() {
                            // Fetch services from the API
                            fetch('/api/services/visible')
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success && data.services && data.services.length > 0) {
                                        const serviceSelect = document.getElementById('service');
                                        
                                        // Group services by category
                                        const servicesByCategory = {};
                                        data.services.forEach(service => {
                                            if (!servicesByCategory[service.category]) {
                                                servicesByCategory[service.category] = [];
                                            }
                                            servicesByCategory[service.category].push(service);
                                        });
                                        
                                        // Add services to dropdown by category
                                        Object.keys(servicesByCategory).forEach(category => {
                                            // Add category optgroup
                                            const optgroup = document.createElement('optgroup');
                                            optgroup.label = category;
                                            serviceSelect.appendChild(optgroup);
                                            
                                            // Add services within the category
                                            servicesByCategory[category].forEach(service => {
                                                const option = document.createElement('option');
                                                option.value = service.name;
                                                option.textContent = `${service.name} (${service.price})`;
                                                optgroup.appendChild(option);
                                            });
                                        });
                                    }
                                })
                                .catch(error => {
                                    console.error('Error loading services:', error);
                                });
                        });
                    </script>
                    
                    <div style="margin-bottom: var(--spacing-sm);">
                        <label for="date" style="display: block; margin-bottom: 5px;">Preferred Date *</label>
                        <input type="date" id="date" name="date" required style="width: 100%; padding: 10px; border: 1px solid var(--color-gray); border-radius: var(--border-radius);">
                    </div>
                    
                    <div style="margin-bottom: var(--spacing-md);">
                        <label for="message" style="display: block; margin-bottom: 5px;">Message</label>
                        <textarea id="message" name="message" rows="4" style="width: 100%; padding: 10px; border: 1px solid var(--color-gray); border-radius: var(--border-radius);"></textarea>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%;">Book Appointment</button>
                </form>
            </div>
        </div>
    </div>
</section>

<!-- Map Section -->
<section class="section">
    <div class="container">
        <h2 class="text-center">Visit Us</h2>
        <div style="margin-top: var(--spacing-md);">
            <!-- Dynamic Map Container -->
            <div 
                id="contact-map-container"
                data-lat="<%= siteInfo.mapLat || '29.4450833' %>"
                data-lng="<%= siteInfo.mapLng || '77.3059167' %>"
                data-address="<%= siteInfo.address %>"
                style="width: 100%; height: 400px; border-radius: var(--border-radius); border: 1px solid #ddd;">
            </div>
            
            <!-- Get Directions Button -->
            <div style="text-align: center; margin-top: 15px;">
                <a href="https://www.google.com/maps/dir/?api=1&destination=<%= siteInfo.mapLat || '29.4450833' %>,<%= siteInfo.mapLng || '77.3059167' %>" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   class="btn"
                   style="display: inline-flex; align-items: center; gap: 8px; background-color: #4285F4; color: white; border: none; padding: 10px 16px;">
                   <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                     <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                   </svg>
                   Get Directions on Google Maps
                </a>
            </div>
            
            <!-- Fallback for browsers without JavaScript or if map fails to load -->
            <noscript>
                <iframe 
                    src="<%= siteInfo.mapEmbedUrl %>" 
                    width="100%" 
                    height="400" 
                    style="border:0; border-radius: var(--border-radius);" 
                    allowfullscreen="" 
                    loading="lazy"
                    referrerpolicy="no-referrer-when-downgrade">
                </iframe>
            </noscript>
        </div>
    </div>
</section>

<!-- Contact Map Script -->
<script src="/js/contact-map.js"></script> 